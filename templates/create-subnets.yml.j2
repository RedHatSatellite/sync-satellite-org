#jinja2:variable_start_string:'[%' , variable_end_string:'%]'
- name:
- name: Generate Subnets
  foreman_subnet:
    server_url: "{{ target_foreman_server_url }}"
    username: "{{ target_foreman_username }}"
    password: "{{ target_foreman_password }}"
    verify_ssl: "{{ foreman_verify_ssl }}"
    name: "{{ item.Name }}"
    boot_mode: "{{ item['Boot Mode'] }}"
    cidr: "{{ item['Network Prefix'] }}"
    dhcp_proxy: "{{ inventory_hostname }}"
    dns_primary: "{{ item['Primary DNS'] }}"
    dns_secondary: "{{ item['Secondary DNS'] }}"
    dns_proxy: "{{ inventory_hostname }}"
    tftp_proxy: "{{ inventory_hostname }}"
    from_ip: "{{ item['Start of IP Range'] }}"
    to_ip: "{{ item['End of IP Range'] }}"
    gateway: "{{ item['Gateway Addr'] }}"
    ipam: "{{ (item.IPAM == 'None')|ternary(omit,item.IPAM) }}"
    mtu: "{{ item.MTU|int }}"
    vlanid: "{{ item.vlanid['VLAN ID']|int }}"
    network_type: "{{ item.Protocol }}"
    network: "{{ item['Network Addr'] }}"
    domains: "{{ item.Domains | json_query('[*].Name') }}"
    organizations:
      - [% foreman_organization %]
    locations: "{{ item.Locations | json_query('[*].Name') }}"
    state: present
  loop: [% subnet_info %]
  delegate_to: localhost
