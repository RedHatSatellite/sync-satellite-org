---
- set_fact:
    cv_lookup: []
  tags: cv
- name: Lookup repos for CV {{ cv.Name }}
  set_fact:
    repo: "{{ (repos | json_query(\"[?Id==`\" + item|string + \"`].Name\"))[0]|default(\"\") }}"
    product: "{{ (repos | json_query(\"[?Id==`\" + item|string + \"`].Product\"))[0]|default(\"\") }}"
    cv_lookup: "{{ cv_lookup + [ {\"Name\": repo, \"Product\": product} ] }}"
  loop: "{{ cv['Repository IDs']}}"
  tags: cv

- debug:
    var: cv_lookup
    verbosity: 2
  tags: cv
- name: Write template to create CV {{ cv.Name }}
  template:
    src: "templates/create-content-views.yml.j2"
    dest: "{{ output_dir + \"/create-content-view-\" + cv.Name + \".yml\" }}"
  tags: cv
